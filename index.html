<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIFA World Cup 2026 Engine</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2023.05.1/pyscript.css">
    <script defer src="https://pyscript.net/releases/2023.05.1/pyscript.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f7; margin: 0; padding: 0; }

        /* --- NEW VISUALIZATION STYLES --- */
        
        /* Groups Grid */
        .groups-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .group-box { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .group-box h3 { margin-top: 0; border-bottom: 2px solid #f1c40f; padding-bottom: 5px; }
        .group-table th { background: #ecf0f1; font-size: 0.9em; }
        .group-table td { padding: 6px 10px; font-size: 0.95em; }
        .qualified { font-weight: bold; color: #27ae60; }

        /* Bracket Flex Layout */
        #bracket-container { display: flex; overflow-x: auto; padding: 20px 0; }
        .bracket-round { display: flex; flex-direction: column; justify-content: space-around; margin-right: 30px; min-width: 200px; }
        .round-title { text-align: center; font-weight: bold; margin-bottom: 15px; color: #7f8c8d; }
        
        /* Matchup Box */
        .matchup { border: 1px solid #ddd; background: white; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; margin-bottom: 20px;}
        .matchup-team { display: flex; justify-content: space-between; padding: 8px 12px; border-bottom: 1px solid #eee; }
        .matchup-team:last-child { border-bottom: none; }
        .winner-text { font-weight: bold; color: #2c3e50; background: #f0fff0; }
        .match-note { font-size: 0.7em; text-align: center; background: #f8f9fa; color: #666; padding: 2px; }

        /* Connecting Lines (Simple CSS approach) */
        .bracket-round:not(:last-child) .matchup::after {
            content: ''; position: absolute; right: -30px; top: 50%;
            width: 30px; height: 2px; background: #ddd; z-index: -1;
        }
        
        /* Loading Screen */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2c3e50; color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 9999;
        }
        .loader { font-size: 2em; font-weight: bold; margin-bottom: 20px; }

        /* Main Dashboard */
        #main-dashboard { display: none; max-width: 1000px; margin: 20px auto; padding: 20px; }
        
        /* Navigation */
        .nav-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        .nav-btn {
            padding: 12px 20px; background: white; border: none; border-radius: 8px;
            font-weight: bold; cursor: pointer; color: #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .nav-btn:hover { background: #3498db; color: white; }
        
        /* Content Tabs */
        .tab-content { 
            background: white; padding: 25px; border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); min-height: 400px;
            display: none; /* Hidden by default */
        }

        /* Modal Popup */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: #fefefe; margin: 10% auto; padding: 20px;
            border: 1px solid #888; width: 80%; max-width: 500px;
            border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .close-btn {
            color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer;
        }
        .close-btn:hover { color: black; }
        
        .result-row {
            display: flex; justify-content: space-between; padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .result-score { font-weight: bold; background: #eee; padding: 2px 8px; border-radius: 4px;}
        
        /* Make groups clickable */
        .group-box { cursor: pointer; transition: transform 0.2s; }
        .group-box:hover { transform: translateY(-3px); border: 1px solid #3498db; }
        
        /* Single Sim specific */
        #single-champion { font-size: 2em; color: #27ae60; font-weight: 800; margin: 20px 0; }
        #single-log-container { height: 300px; overflow-y: auto; background: #2c3e50; color: #ecf0f1; padding: 15px; font-family: monospace; }
        
        /* General Utils */
        .log-entry { margin-bottom: 4px; font-size: 0.9em; }
        .log-header { color: #f1c40f; font-weight: bold; margin-top: 10px; }
        input, select { padding: 10px; border-radius: 5px; border: 1px solid #ddd; }
        button.action-btn { background: #2ecc71; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loader">‚öΩ Preparing Engine...</div>
        <div>Downloading Data & Booting Python</div>
    </div>

    <div id="main-dashboard">
        <h1>üèÜ WC 2026 Engine</h1>
        
        <div class="nav-bar">
            <button class="nav-btn" id="btn-tab-single">Single Sim</button>
            <button class="nav-btn" id="btn-tab-bulk">Bulk Sim</button>
            <button class="nav-btn" id="btn-tab-data">Data View</button>
            <button class="nav-btn" id="btn-tab-history">Team Analysis</button>
        </div>

        <div id="tab-single" class="tab-content" style="display:block">
            <div style="display:flex; justify-content: space-between; align-items: center;">
                 <h2>Tournament Visualization</h2>
                 <button class="action-btn" id="btn-run-single">‚ñ∂ Run Tournament</button>
            </div>

            <div id="visual-loading" style="display:none; color:#666; font-style:italic; margin:20px;">
                Simulating match results...
            </div>

            <div id="visual-results-container" style="display:none;">
                <div id="final-champion-banner" style="text-align:center; background:#27ae60; color:white; padding:20px; border-radius:8px; margin: 20px 0;">
                    <div style="font-size:0.9em; opacity:0.8;">WORLD CUP 2026 CHAMPION</div>
                    <div id="visual-champion-name" style="font-size:2.5em; font-weight:800;">---</div>
                </div>

                <h3>Group Stage Results</h3>
                <div id="groups-container" class="groups-grid"></div>

                <h3>Knockout Bracket</h3>
                <div id="bracket-container"></div>
            </div>
        </div>

        <div id="tab-bulk" class="tab-content">
            <h2>Bulk Simulation</h2>
            <p>Run the tournament multiple times to see probability of winning.</p>
            <input type="number" id="bulk-count" value="50" min="1" max="500">
            <button class="action-btn" id="btn-run-bulk">Run Sims</button>
            <div id="bulk-results" style="margin-top:20px;"></div>
        </div>

        <div id="tab-data" class="tab-content">
            <h2>Global Rankings & Stats</h2>
            <div id="data-table-container"></div>
        </div>

        <div id="tab-history" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>Team Analysis</h2>
                
                <div style="display:flex; gap:10px;">
                    <select id="team-select" style="min-width:200px;"></select>
                    <select id="chart-timeframe">
                        <option value="all">All Time</option>
                        <option value="10y">Last 10 Years</option>
                        <option value="4y">Since Last WC</option>
                    </select>
                    <button class="action-btn" id="btn-view-history">Analyze</button>
                </div>
            </div>

            <div id="history-output" style="margin-top:20px; display:grid; grid-template-columns: 1fr 2fr; gap:20px;">
                <div id="team-stats-card"></div>
                <div id="main-chart-container" style="background:#f8f9fa; border-radius:8px; padding:10px; min-height:300px;"></div>
            </div>
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:20px;">
                 <div id="dist-chart-container" style="background:white; height:300px;"></div>
            </div>
        </div>

        <div id="group-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="document.getElementById('group-modal').style.display='none'">&times;</span>
            <h2 id="modal-title">Group Results</h2>
            <div id="modal-matches"></div>
        </div>
    </div>

    </div>

    <py-config>
        packages = ["pandas", "numpy", "matplotlib"] 
        
        [[fetch]]
        files = ["main.py", "simulation_engine.py"]

        [[fetch]]
        from = "https://raw.githubusercontent.com/APmsj09/Fifa_Elo_Sim/main/data"
        files = ["results.csv", "goalscorers.csv", "former_names.csv"]
    </py-config>

    <py-script src="./main.py"></py-script>

</body>
</html>