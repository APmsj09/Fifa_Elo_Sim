<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIFA World Cup 2026 Predictor</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2023.05.1/pyscript.css" />
    <script defer src="https://pyscript.net/releases/2023.05.1/pyscript.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; color: #333; max-width: 900px; margin: 0 auto; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #1a1a1a; text-align: center; }
        h3 { color: #555; text-align: center; margin-top: -10px; }
        
        /* The Run Button */
        .btn-container { text-align: center; margin: 30px 0; }
        button {
            background-color: #2ecc71; color: white; border: none; padding: 15px 30px; 
            font-size: 18px; border-radius: 8px; cursor: pointer; transition: 0.3s;
            font-weight: bold;
        }
        button:hover { background-color: #27ae60; transform: scale(1.05); }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        /* Results Area */
        #champion-box { 
            display: none; background: #e8f8f5; border-left: 5px solid #2ecc71; 
            padding: 20px; margin-bottom: 20px; text-align: center; 
        }
        #champion-text { color: #27ae60; font-size: 2em; margin: 10px 0; font-weight: 800; }
        
        #log-container { 
            height: 400px; overflow-y: scroll; background: #2c3e50; color: #ecf0f1; 
            padding: 20px; border-radius: 8px; font-family: monospace; font-size: 14px;
            display: none; /* Hidden until run */
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #34495e; padding-bottom: 2px; }
        .log-header { color: #f1c40f; font-weight: bold; margin-top: 15px; border-bottom: none; }
        
        /* Loading Spinner */
        #loading { text-align: center; color: #7f8c8d; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>üèÜ FIFA World Cup 2026 Sim</h1>
    <h3>Powered by Python & PyScript</h3>

    <py-config>
        packages = ["pandas", "numpy"]
        [[fetch]]
        from = "./data/"
        files = ["results.csv", "goalscorers.csv", "former_names.csv"]
        [[fetch]]
        from = "./"
        files = ["simulation_engine.py"]
    </py-config>

    <div class="btn-container">
        <button id="run-btn" py-click="start_simulation">‚öΩ Kick Off Simulation</button>
    </div>

    <div id="loading">Initializing Python Engine... (This may take a moment)</div>

    <div id="champion-box">
        <div>WINNER</div>
        <div id="champion-text">---</div>
    </div>

    <div id="log-container"></div>
</div>

<py-script>
import simulation_engine as sim
import js
from pyodide.ffi import create_proxy

# 1. Initialize Engine on Load
print("Initializing Engine...")
# We need to monkey-patch the DATA_DIR in the engine because PyScript file structure is flat
sim.DATA_DIR = "." 
# Run the setup function
sim.TEAM_STATS, sim.TEAM_PROFILES, sim.AVG_GOALS = sim.initialize_engine()

# Remove loading text and enable button
js.document.getElementById("loading").innerHTML = "Ready! Click the button above."

def start_simulation(*args):
    # 1. UI Updates (Show loading state)
    js.document.getElementById("champion-box").style.display = "none"
    log_div = js.document.getElementById("log-container")
    log_div.style.display = "block"
    log_div.innerHTML = "<div class='log-entry'>Simulating tournament... please wait...</div>"

    # 2. Run the Logic
    result = sim.run_simulation(verbose=True)
    champion = result['champion']
    logs = result['logs']

    # 3. Update Champion Display
    js.document.getElementById("champion-text").innerText = champion.upper()
    js.document.getElementById("champion-box").style.display = "block"

    # 4. Render Logs
    log_html = ""
    for line in logs:
        # Style headers (lines with ===) differently
        if "===" in line:
            log_html += f"<div class='log-entry log-header'>{line}</div>"
        else:
            log_html += f"<div class='log-entry'>{line}</div>"
    
    log_div.innerHTML = log_html
</py-script>

</body>
</html>
